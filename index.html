<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoReel AI</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    textarea {
      width: 100%;
      height: 120px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
    }
    video, audio {
      display: block;
      margin-top: 20px;
      width: 100%;
      max-width: 600px;
    }
    a.download {
      display: inline-block;
      margin-top: 10px;
      background: #4CAF50;
      color: white;
      padding: 10px;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>AutoReel AI - Text to Video</h1>
  <textarea id="textInput" placeholder="Enter your text here..."></textarea>
  <button onclick="generateVideo()">Generate Video</button><video id="videoPreview" controls></video> <audio id="audioPreview" controls></audio> <a id="downloadLink" class="download" style="display:none" download="audioreel.mp3">Download Audio</a>

  <script>
    const elevenApiKey = "sk_3db5edeb7be2cf74b911f4e90d678784b726b29017067bfa";
    const pexelsApiKey = "kQkFcGsak0LwXThqyKjrhAArwowizrHoeH9aja6988VqohTXR33b2Wpo";
    const voiceId = "pqHfZKP75CvOlQylNhV4"; // صوت واقعي

    async function generateVideo() {
      const text = document.getElementById("textInput").value;
      if (!text) return alert("Please enter text.");

      // Step 1: Get random video from Pexels
      const videoUrl = await getRandomVideo();
      if (!videoUrl) return alert("Failed to fetch video.");
      document.getElementById("videoPreview").src = videoUrl;

      // Step 2: Generate voice from ElevenLabs
      const audioBlob = await generateVoice(text);
      if (!audioBlob) return alert("Failed to generate voice.");
      const audioUrl = URL.createObjectURL(audioBlob);
      const audio = document.getElementById("audioPreview");
      audio.src = audioUrl;
      audio.load();

      // Step 3: Allow download
      const downloadLink = document.getElementById("downloadLink");
      downloadLink.href = audioUrl;
      downloadLink.style.display = "inline-block";
    }

    async function getRandomVideo() {
      try {
        const response = await fetch("https://api.pexels.com/videos/search?query=nature&per_page=1", {
          headers: { Authorization: pexelsApiKey }
        });
        const data = await response.json();
        return data.videos[0].video_files.find(v => v.quality === "sd").link;
      } catch (err) {
        console.error(err);
        return null;
      }
    }

    async function generateVoice(text) {
      try {
        const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}/stream`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "xi-api-key": elevenApiKey
          },
          body: JSON.stringify({
            text: text,
            model_id: "eleven_monolingual_v1",
            voice_settings: {
              stability: 0.5,
              similarity_boost: 0.75
            }
          })
        });
        if (!response.ok) throw new Error("Audio generation failed");
        return await response.blob();
      } catch (err) {
        console.error(err);
        return null;
      }
    }
  </script></body>
</html>
